{% extends "base.html" %}

{% block title %}{{ tournament.name }} - Pickleball Tournament Platform{% endblock %}

{% block content %}
<!-- Tournament Banner -->
<div class="relative w-full h-64 rounded-lg overflow-hidden mb-8">
    {% if tournament.banner %}
        <img src="{{ tournament.banner }}" alt="{{ tournament.name }}" class="w-full h-full object-cover">
    {% else %}
        <div class="w-full h-full bg-gradient-to-r from-blue-600 to-indigo-700 flex items-center justify-center">
            <span class="text-white text-3xl font-bold">{{ tournament.name }}</span>
        </div>
    {% endif %}
    <div class="absolute inset-0 bg-gradient-to-r from-blue-900/70 to-transparent flex items-center">
        <div class="px-8">
            <h1 class="text-4xl font-bold text-white">{{ tournament.name }}</h1>
            <p class="text-xl text-white mt-2">{{ tournament.start_date.strftime('%B %d') }}-{{ tournament.end_date.strftime('%d, %Y') }}</p>
        </div>
    </div>
    <div class="absolute top-4 right-4">
        <div class="badge-{{ tournament.tier.value }} px-3 py-1 rounded-full text-sm font-medium inline-flex items-center">
            {{ tournament.tier.value }}
        </div>
    </div>
</div>

<!-- Tournament Navigation -->
<div class="mb-8 bg-white rounded-lg shadow-sm overflow-x-auto">
    <div class="flex p-1 gap-1">
        <button class="tab-button px-4 py-2 font-medium text-blue-600 bg-blue-50 rounded" data-target="info-section">Info</button>
        <button class="tab-button px-4 py-2 font-medium text-gray-600 hover:text-blue-600 hover:bg-gray-50 rounded" data-target="categories-section">Categories</button>
        <button class="tab-button px-4 py-2 font-medium text-gray-600 hover:text-blue-600 hover:bg-gray-50 rounded" data-target="prizes-section">Prizes</button>
        <button class="tab-button px-4 py-2 font-medium text-gray-600 hover:text-blue-600 hover:bg-gray-50 rounded" data-target="gifts-section">Door Gifts</button>
        {% if tournament.status.value in ['ongoing', 'completed'] %}
        <button class="tab-button px-4 py-2 font-medium text-gray-600 hover:text-blue-600 hover:bg-gray-50 rounded" data-target="matches-section">Matches</button>
        {% endif %}
    </div>
</div>

<!-- Tournament Info Section -->
<div id="info-section" class="tab-content grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
    <!-- Tournament Info -->
    <div class="md:col-span-2">
        <div class="bg-white p-6 rounded-lg shadow-sm">
            <h2 class="text-2xl font-bold mb-4">About This Tournament</h2>
            <div class="space-y-4">
                <div>
                    <h3 class="text-gray-600 font-medium">Location</h3>
                    <p class="text-gray-900">{{ tournament.location }}</p>
                </div>
                <div>
                    <h3 class="text-gray-600 font-medium">Dates</h3>
                    <p class="text-gray-900">{{ tournament.start_date.strftime('%B %d') }}-{{ tournament.end_date.strftime('%d, %Y') }}</p>
                </div>
                <div>
                    <h3 class="text-gray-600 font-medium">Registration Deadline</h3>
                    <p class="text-gray-900">{{ tournament.registration_deadline.strftime('%B %d, %Y') }}</p>
                </div>
                <div>
                    <h3 class="text-gray-600 font-medium">Format</h3>
                    <p class="text-gray-900">{{ tournament.format.value }}</p>
                </div>
                <div>
                    <h3 class="text-gray-600 font-medium">Prize Pool</h3>
                    <p class="text-gray-900">${{ tournament.prize_pool|int }}</p>
                </div>
                <div>
                    <h3 class="text-gray-600 font-medium">Description</h3>
                    <div class="text-gray-900">{{ tournament.description|nl2br }}</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Registration Actions -->
    <div>
        <div class="bg-white p-6 rounded-lg shadow-sm">
            <h2 class="text-2xl font-bold mb-4">Registration</h2>
            {% if tournament.status.value == 'upcoming' %}
                {% if tournament.is_registration_open() %}
                    {% if current_user.is_authenticated and current_user.is_player() %}
                        <a href="{{ url_for('player.register_tournament', tournament_id=tournament.id) }}" class="w-full block text-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition mb-4">
                            Register Now
                        </a>
                    {% else %}
                        <a href="{{ url_for('auth.login') }}?next={{ url_for('player.register_tournament', tournament_id=tournament.id) }}" class="w-full block text-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition mb-4">
                            Sign In to Register
                        </a>
                    {% endif %}
                {% else %}
                    <div class="w-full block text-center px-4 py-2 bg-gray-300 text-gray-600 rounded-lg mb-4">
                        Registration Closed
                    </div>
                {% endif %}
            {% endif %}

            <div class="space-y-2">
                <a href="{{ url_for('tournament.participants', id=tournament.id) }}" class="w-full block text-center px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                    View Participants
                </a>
                
                {% if tournament.status.value in ['ongoing', 'completed'] %}
                    <a href="{{ url_for('tournament.bracket', id=tournament.id) }}" class="w-full block text-center px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                        View Brackets
                    </a>
                    
                    {% if tournament.status.value == 'ongoing' %}
                        <a href="{{ url_for('tournament.live_scoring', id=tournament.id) }}" class="w-full block text-center px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                            Live Scoring
                        </a>
                    {% endif %}
                    
                    {% if tournament.status.value == 'completed' %}
                        <a href="{{ url_for('tournament.results', id=tournament.id) }}" class="w-full block text-center px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                            View Results
                        </a>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Categories Section -->
<div id="categories-section" class="tab-content mb-8 hidden">
    <div class="bg-white p-6 rounded-lg shadow-sm">
        <h2 class="text-2xl font-bold mb-4">Tournament Categories</h2>
        
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Format</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Max Participants</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Registration Fee</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Points</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Restrictions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for category in categories %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ category.category_type.value }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ category.format.value if category.format else tournament.format.value }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ category.max_participants }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${{ category.registration_fee }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600">{{ category.points_awarded }} pts</td>
                        <td class="px-6 py-4 text-sm text-gray-500">
                            <ul class="list-disc pl-5">
                                {% if category.min_dupr_rating or category.max_dupr_rating %}
                                <li>
                                    DUPR Rating: 
                                    {% if category.min_dupr_rating and category.max_dupr_rating %}
                                        {{ category.min_dupr_rating }} - {{ category.max_dupr_rating }}
                                    {% elif category.min_dupr_rating %}
                                        Min {{ category.min_dupr_rating }}
                                    {% elif category.max_dupr_rating %}
                                        Max {{ category.max_dupr_rating }}
                                    {% endif %}
                                </li>
                                {% endif %}
                                
                                {% if category.min_age or category.max_age %}
                                <li>
                                    Age: 
                                    {% if category.min_age and category.max_age %}
                                        {{ category.min_age }} - {{ category.max_age }} years
                                    {% elif category.min_age %}
                                        Min {{ category.min_age }} years
                                    {% elif category.max_age %}
                                        Max {{ category.max_age }} years
                                    {% endif %}
                                </li>
                                {% endif %}
                                
                                {% if category.gender_restriction %}
                                <li>
                                    Gender: {{ category.gender_restriction|capitalize }}
                                </li>
                                {% endif %}
                                
                                {% if not category.min_dupr_rating and not category.max_dupr_rating and not category.min_age and not category.max_age and not category.gender_restriction %}
                                <li>No restrictions</li>
                                {% endif %}
                            </ul>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Prizes Section -->
<div id="prizes-section" class="tab-content mb-8 hidden">
    <div class="bg-white p-6 rounded-lg shadow-sm">
        <h2 class="text-2xl font-bold mb-4">Tournament Prizes</h2>
        
        {% if tournament.prize_pool %}
        <div class="mb-6">
            <p class="text-xl font-bold text-blue-600">Total Prize Pool: ${{ tournament.prize_pool|int }}</p>
        </div>
        {% endif %}
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for category in categories %}
                {% if category.prize_percentage > 0 %}
                <div class="border border-gray-200 rounded-lg p-4">
                    <h3 class="font-bold text-lg mb-2">{{ category.category_type.value }}</h3>
                    <p class="mb-4">Prize: ${{ (tournament.prize_pool * category.prize_percentage / 100)|int }}</p>
                    
                    {% if category.prize_distribution %}
                        <div class="space-y-2">
                            {% for place, percentage in category.prize_distribution.items() %}
                                <div class="flex justify-between">
                                    <span>{{ place }} place:</span>
                                    <span>${{ (tournament.prize_pool * category.prize_percentage / 100 * percentage / 100)|int }}</span>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</div>

<!-- Door Gifts Section -->
<div id="gifts-section" class="tab-content mb-8 hidden">
    <div class="bg-white p-6 rounded-lg shadow-sm">
        <h2 class="text-2xl font-bold mb-4">Complimentary for Registered Players</h2>
        
        {% if tournament.door_gifts %}
        <div class="mb-6">
            <p class="text-gray-700 whitespace-pre-line">{{ tournament.door_gifts|nl2br }}</p>
        </div>
        {% endif %}
        
        {% if tournament.door_gifts_image %}
        <div class="mb-6">
            <img src="{{ tournament.door_gifts_image }}" alt="Door Gifts" class="rounded-lg max-h-96 mx-auto">
        </div>
        {% endif %}
        
        {% if not tournament.door_gifts and not tournament.door_gifts_image %}
        <div class="text-center py-8 text-gray-500">
            <p>No door gifts information available.</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Matches Section -->
{% if tournament.status.value in ['ongoing', 'completed'] %}
<div id="matches-section" class="tab-content mb-8 hidden">
    <div class="bg-white p-6 rounded-lg shadow-sm">
        <h2 class="text-2xl font-bold mb-4">Tournament Matches</h2>
        
        <!-- Category Selection Tabs -->
        <div class="flex gap-2 mb-6 border-b border-gray-200 pb-2 overflow-x-auto">
            {% for category in categories %}
                <button class="category-tab py-2 px-4 rounded-t-lg font-medium {% if loop.first %}bg-blue-800 text-white{% else %}bg-white text-gray-700 border border-gray-200 hover:bg-gray-50{% endif %}" 
                    data-target="category-matches-{{ category.id }}">
                    {{ category.category_type.value }}
                </button>
            {% endfor %}
        </div>
        
        <!-- Category Matches Content -->
        {% for category in categories %}
            <div id="category-matches-{{ category.id }}" class="category-content {% if not loop.first %}hidden{% endif %}">
                {% if matches and category.id in matches and matches[category.id] %}
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {% for match in matches[category.id] %}
                            <!-- Match card content would go here -->
                            <div class="border border-gray-200 rounded-lg p-4">
                                <p>Match details</p>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-8 text-gray-500">
                        <p>No matches available for this category.</p>
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Tab navigation functionality
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Get target content ID
                const targetId = this.getAttribute('data-target');
                
                // Reset all tabs and contents
                tabButtons.forEach(btn => {
                    btn.classList.remove('text-blue-600', 'bg-blue-50');
                    btn.classList.add('text-gray-600', 'hover:text-blue-600', 'hover:bg-gray-50');
                });
                
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Activate clicked tab
                this.classList.add('text-blue-600', 'bg-blue-50');
                this.classList.remove('text-gray-600', 'hover:text-blue-600', 'hover:bg-gray-50');
                
                // Show selected content
                document.getElementById(targetId).classList.remove('hidden');
            });
        });
        
        // Category tabs for matches
        const categoryTabs = document.querySelectorAll('.category-tab');
        const categoryContents = document.querySelectorAll('.category-content');
        
        categoryTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                
                categoryTabs.forEach(t => {
                    t.classList.remove('bg-blue-800', 'text-white');
                    t.classList.add('bg-white', 'text-gray-700', 'border', 'border-gray-200', 'hover:bg-gray-50');
                });
                
                categoryContents.forEach(content => {
                    content.classList.add('hidden');
                });
                
                this.classList.add('bg-blue-800', 'text-white');
                this.classList.remove('bg-white', 'text-gray-700', 'border', 'border-gray-200', 'hover:bg-gray-50');
                
                document.getElementById(targetId).classList.remove('hidden');
            });
        });
        
        // Check for hash in URL to activate specific tab
        const hash = window.location.hash.substring(1);
        if (hash) {
            const targetTab = document.querySelector(`[data-target="${hash}-section"]`);
            if (targetTab) {
                targetTab.click();
            }
        }
    });
</script>
{% endblock %}